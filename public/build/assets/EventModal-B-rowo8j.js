import{r,m as M,a as F,j as t}from"./index.esm-DYHbi2wE.js";import{A as P}from"./index-CkxCHxkU.js";import{m as f}from"./proxy-oAEZJcFV.js";import{f as R}from"./format-C9qPCfVZ.js";function O({event:m,isOpen:x,onClose:_,onEventUpdate:c,auth:u}){var j,v;if(!x)return null;const[d,a]=r.useState(!1),[e,h]=r.useState(m),[n,y]=r.useState(null),[i,N]=r.useState([]),[w,g]=r.useState(!1),{post:E,delete:T,data:b,setData:S,reset:$}=M({team_id:""});r.useEffect(()=>{h({...m,is_enrolled:!!m.is_enrolled})},[m]),r.useEffect(()=>{x&&e.is_team_event&&!e.is_enrolled&&!e.is_external&&k()},[x,e.event_id,e.is_team_event]);const k=async()=>{g(!0);try{const s=await F.get(route("events.available-teams",e.event_id));N(s.data)}catch(s){console.error("Failed to load teams:",s)}finally{g(!1)}},p=e.is_team_event?e.enrolled_teams_count/e.max_participants*100:e.enrolled_count/e.max_participants*100,C=s=>{const o=s.target.value;S("team_id",o),y(i.find(l=>l.id===o))},A=()=>{if(a(!0),e.is_team_event&&!e.is_external&&!b.team_id){alert("Please select a team to enroll"),a(!1);return}E(route("events.enroll",e.event_id),{preserveScroll:!0,onSuccess:()=>{a(!1),h(s=>({...s,is_enrolled:!0,enrolled_count:s.is_team_event?s.enrolled_count+((n==null?void 0:n.members_count)||0):s.enrolled_count+1,enrolled_teams_count:s.is_team_event?(s.enrolled_teams_count||0)+1:s.enrolled_teams_count})),c&&c({...e,is_enrolled:!0,enrolled_count:e.is_team_event?e.enrolled_count+((n==null?void 0:n.members_count)||0):e.enrolled_count+1,enrolled_teams_count:e.is_team_event?(e.enrolled_teams_count||0)+1:e.enrolled_teams_count,enrolled_team:n}),$()},onError:()=>a(!1)})},z=()=>{a(!0),T(route("events.unenroll",e.event_id),{preserveScroll:!0,onSuccess:()=>{var o;a(!1);const s=((o=e.enrolled_team)==null?void 0:o.member_count)||1;h(l=>({...l,is_enrolled:!1,enrolled_count:l.is_team_event?l.enrolled_count-s:l.enrolled_count-1,enrolled_teams_count:l.is_team_event?(l.enrolled_teams_count||0)-1:l.enrolled_teams_count,enrolled_team:null})),c&&c({...e,is_enrolled:!1,enrolled_count:e.is_team_event?e.enrolled_count-s:e.enrolled_count-1,enrolled_teams_count:e.is_team_event?(e.enrolled_teams_count||0)-1:e.enrolled_teams_count,enrolled_team:null})},onError:()=>a(!1)})},L=()=>{window.open(e.registration_url,"_blank")};return t.jsx(P,{children:t.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:t.jsxs("div",{className:"flex min-h-screen items-center justify-center p-4",children:[t.jsx(f.div,{style:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:_,className:"fixed inset-0 bg-black/60 backdrop-blur-sm"}),t.jsxs(f.div,{style:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"relative w-full max-w-2xl rounded-2xl bg-[#1E1E2E] shadow-xl",children:[t.jsx("button",{onClick:_,className:"absolute right-4 top-4 text-gray-400 hover:text-white transition-colors",children:t.jsx("span",{className:"material-symbols-outlined",children:"close"})}),t.jsxs("div",{className:"relative h-48 rounded-t-2xl overflow-hidden",children:[t.jsx("img",{src:e.cover_image?`/${e.cover_image}`:"/default-event-image.jpg",alt:e.title,className:"w-full h-full object-cover"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#1E1E2E] to-transparent"})]}),t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:e.title}),t.jsxs("div",{className:"flex items-center space-x-2",children:[e.is_external&&t.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-purple-500/20 text-purple-400",children:"External Event"}),e.is_team_event&&t.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-blue-500/20 text-blue-400",children:"Team Event"}),t.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${e.status==="Upcoming"?"bg-green-500/20 text-green-400":e.status==="Ongoing"?"bg-blue-500/20 text-blue-400":"bg-gray-500/20 text-gray-400"}`,children:e.status})]})]}),t.jsx("p",{className:"text-gray-400 mt-1",children:e.is_external?`Organized by ${e.organizer_name}`:`Created by ${e.creator.name}`})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Date & Time"}),t.jsxs("div",{className:"flex items-center text-white",children:[t.jsx("span",{className:"material-symbols-outlined mr-2 text-blue-400",children:"calendar_today"}),t.jsxs("span",{children:[R(new Date(e.date),"MMMM dd, yyyy")," at ",e.formatted_time]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Location"}),t.jsxs("div",{className:"flex items-center text-white",children:[t.jsx("span",{className:"material-symbols-outlined mr-2 text-green-400",children:"location_on"}),t.jsx("span",{children:e.location})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Event Type"}),t.jsxs("div",{className:"flex items-center text-white",children:[t.jsx("span",{className:"material-symbols-outlined mr-2 text-purple-400",children:"category"}),t.jsx("span",{children:e.event_type})]})]}),e.is_team_event&&!e.is_external&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Team Requirements"}),t.jsxs("div",{className:"flex items-center text-white",children:[t.jsx("span",{className:"material-symbols-outlined mr-2 text-amber-400",children:"group"}),t.jsx("span",{children:e.min_team_members===e.max_team_members?`Exactly ${e.min_team_members} members per team`:`${e.min_team_members}-${e.max_team_members} members per team`})]})]}),!e.is_external&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:e.is_team_event?"Team Enrollment Status":"Enrollment Status"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{className:"text-white",children:e.is_team_event?`${e.enrolled_teams_count||0} teams enrolled of ${e.max_participants} spots`:`${e.enrolled_count} enrolled of ${e.max_participants} spots`}),t.jsx("span",{className:"text-white",children:e.is_team_event?`${((e.enrolled_teams_count||0)/e.max_participants*100).toFixed(0)}%`:`${(e.enrolled_count/e.max_participants*100).toFixed(0)}%`})]}),t.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:t.jsx("div",{className:`h-2 rounded-full ${p>=90?"bg-red-500":p>=75?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(p,100)}%`}})})]})]}),e.is_enrolled&&e.is_team_event&&e.enrolled_team&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Your Team"}),t.jsxs("div",{className:"flex items-center text-white",children:[t.jsx("span",{className:"material-symbols-outlined mr-2 text-indigo-400",children:"people"}),t.jsxs("span",{children:[e.enrolled_team.name," (",e.enrolled_team.member_count," members)"]})]})]}),e.is_external&&e.organizer_website&&t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Organizer Website"}),t.jsxs("div",{className:"flex items-center text-white",children:[t.jsx("span",{className:"material-symbols-outlined mr-2 text-blue-400",children:"language"}),t.jsx("a",{href:e.organizer_website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 transition-colors",children:"Visit Website"})]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Description"}),t.jsx("p",{className:"text-white whitespace-pre-line",children:e.description})]}),e.is_team_event&&!e.is_external&&!e.is_enrolled&&e.status==="Upcoming"&&t.jsxs("div",{className:"mt-6",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Select Your Team"}),w?t.jsx("div",{className:"text-gray-400",children:"Loading available teams..."}):i.length===0?t.jsxs("div",{children:[t.jsx("div",{className:"text-amber-400",children:"You don't have any eligible teams that meet the size requirements. Create a team or adjust your existing team before enrolling."}),t.jsx("div",{children:t.jsx("span",{className:"text-xs text-red-400 mt-1",children:"*Only Team Leaders can unenroll their teams."})})]}):t.jsxs("select",{value:b.team_id,onChange:C,className:"w-full bg-[#2A2A3A] border border-gray-700 rounded-lg px-4 py-2 text-white",children:[t.jsx("option",{value:"",children:"Select a team"}),i.map(s=>t.jsxs("option",{value:s.id,children:[s.name," (",s.members_count," members)"]},s.id))]})]}),t.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[t.jsx("button",{onClick:_,className:"px-4 py-2 text-gray-400 hover:text-white transition-colors",children:"Close"}),e.is_external?t.jsx("button",{onClick:L,className:"px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg transition-colors",children:"Register at External Site"}):e.is_enrolled?e.is_team_event&&e.enrolled_team&&e.enrolled_team.creator_id!==((j=u==null?void 0:u.user)==null?void 0:j.id)?t.jsxs("div",{className:"flex flex-col items-end",children:[t.jsx("button",{disabled:!0,className:"px-4 py-2 bg-gray-500 text-white rounded-lg transition-colors opacity-50 cursor-not-allowed",children:"Team Leader Action Required"}),t.jsxs("span",{className:"text-xs text-yellow-400 mt-1",children:["Only ",((v=e.enrolled_team.creator)==null?void 0:v.name)||"the team leader"," can unenroll the team"]})]}):t.jsx("button",{onClick:z,disabled:d||e.status!=="Upcoming",className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Processing...":e.is_team_event?"Unenroll Team":"Unenroll"}):t.jsx("button",{onClick:A,disabled:d||e.status!=="Upcoming"||(e.is_team_event?e.enrolled_teams_count>=e.max_participants||!b.team_id||i.length===0:e.enrolled_count>=e.max_participants),className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Processing...":e.is_team_event?e.enrolled_teams_count>=e.max_participants?"Event Full":i.length===0?"No Eligible Teams":"Enroll Team":e.enrolled_count>=e.max_participants?"Event Full":"Enroll Now"})]})]})]})]})})})}export{O as E};
