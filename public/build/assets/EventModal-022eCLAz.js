import{r,j as e}from"./index-D3Bj6weo.js";import{a as F,m as z}from"./index.esm-CYkcvaz4.js";import{T as R}from"./TagDisplay-Bl1IuvVv.js";import{m as N}from"./proxy-CrpZcEeN.js";import{A as I}from"./index-Dh0BU1j3.js";import{f as M}from"./format-CzgadoOX.js";const P=({event:a,className:y=""})=>{var k,j,C;const[p,d]=r.useState(!1),[b,u]=r.useState(!1),[o,t]=r.useState(a.share_url||((k=a.getShareUrl)==null?void 0:k.call(a))||""),[x,c]=r.useState("bottom"),w=async l=>{var E;const n=o||a.share_url||((E=a.getShareUrl)==null?void 0:E.call(a)),_=`Check out this event: ${a.title}`;let i="";switch(l){case"copy":try{await navigator.clipboard.writeText(n),alert("Link copied to clipboard!")}catch(f){console.error("Failed to copy: ",f);const g=document.createElement("textarea");g.value=n,document.body.appendChild(g),g.select();try{document.execCommand("copy"),alert("Link copied to clipboard!")}catch(S){console.error("Fallback copy failed: ",S),alert("Failed to copy link. Please copy manually: "+n)}document.body.removeChild(g)}break;case"whatsapp":i=`https://wa.me/?text=${encodeURIComponent(`${_}

${n}`)}`;break;case"telegram":i=`https://t.me/share/url?url=${encodeURIComponent(n)}&text=${encodeURIComponent(_)}`;break;case"facebook":i=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(n)}`;break;case"email":i=`mailto:?subject=${encodeURIComponent(`Event: ${a.title}`)}&body=${encodeURIComponent(`${_}

${n}`)}`;break}i&&window.open(i,"_blank","width=600,height=400"),d(!1)},h=async()=>{if(a.event_id){u(!0);try{const l=await F.post(route("events.regenerate-share-token",a.event_id));t(l.data.share_url),alert("New share link generated!")}catch(l){console.error("Failed to generate new link:",l),alert("Failed to generate new link. Please try again.")}finally{u(!1)}}},$=[{name:"WhatsApp",icon:"/images/icon/WhatsApp_Logo_green.svg.png",action:"whatsapp",isCustomIcon:!0},{name:"Telegram",icon:"/images/icon/Telegram_2019_Logo.svg.png",action:"telegram",isCustomIcon:!0},{name:"Facebook",icon:"/images/icon/2023_Facebook_icon.svg.png",action:"facebook",isCustomIcon:!0},{name:"Gmail",icon:"/images/icon/Gmail_icon_(2020).svg.png",action:"email",isCustomIcon:!0}];return e.jsxs("div",{className:`relative ${y}`,children:[e.jsxs(N.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{const l=document.activeElement;if(l){const n=l.getBoundingClientRect(),_=window.innerHeight-n.bottom,i=n.top;c(_<300&&i>300?"top":"bottom")}d(!p)},className:"flex items-center space-x-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors duration-200",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"})}),e.jsx("span",{className:"text-sm font-medium",children:"Share"})]}),e.jsx(I,{children:p&&e.jsxs(e.Fragment,{children:[e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>d(!1),className:"fixed inset-0 z-[9998]"}),e.jsxs(N.div,{initial:{opacity:0,scale:.95,y:x==="top"?-10:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:x==="top"?-10:10},className:`absolute right-0 w-64 bg-[#2A2A3A] border border-gray-700 rounded-lg shadow-xl z-[9999] ${x==="top"?"bottom-full mb-2":"top-full mt-2"}`,children:[e.jsx("div",{className:`absolute right-4 w-0 h-0 border-l-4 border-r-4 border-b-4 border-transparent ${x==="top"?"top-full border-t-4 border-t-[#2A2A3A]":"bottom-full border-b-4 border-b-[#2A2A3A]"}`}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-white font-medium mb-3",children:"Share Event"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Share Link"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:o||"",readOnly:!0,className:"flex-1 bg-[#1E1E2E] border border-gray-600 rounded px-3 py-2 text-xs text-white"}),e.jsx("button",{onClick:()=>w("copy"),className:"px-2 py-2 bg-gray-600 hover:bg-gray-500 rounded text-white transition-colors",children:e.jsxs("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),e.jsx("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"})]})})]})]}),a.creator_id===((C=(j=window.auth)==null?void 0:j.user)==null?void 0:C.id)&&e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:h,disabled:b,className:"w-full px-3 py-2 bg-amber-500 hover:bg-amber-600 disabled:bg-gray-600 text-white rounded text-sm transition-colors",children:b?"Generating...":"Generate New Link"})}),e.jsx("div",{className:"space-y-2",children:$.map(l=>e.jsxs("button",{onClick:()=>w(l.action),className:"w-full flex items-center space-x-3 px-3 py-2 text-left text-white hover:bg-[#1E1E2E] rounded transition-colors",children:[l.isCustomIcon?e.jsx("img",{src:l.icon,alt:l.name,className:"w-5 h-5 object-contain"}):e.jsx("span",{className:"material-symbols-outlined text-lg",children:l.icon}),e.jsx("span",{className:"text-sm",children:l.name})]},l.action))})]})]})]})})]})};function q({event:a,isOpen:y,onClose:p,onEventUpdate:d,auth:b}){var T,A;if(!y)return null;const[u,o]=r.useState(!1),[t,x]=r.useState(a),[c,w]=r.useState(null),[h,$]=r.useState([]),[k,j]=r.useState(!1),{post:C,delete:l,data:n,setData:_,reset:i}=z({team_id:""});r.useEffect(()=>{x({...a,is_enrolled:!!a.is_enrolled})},[a]),r.useEffect(()=>{y&&t.is_team_event&&!t.is_enrolled&&!t.is_external&&E()},[y,t.event_id,t.is_team_event]);const E=async()=>{j(!0);try{const s=await F.get(route("events.available-teams",t.event_id));$(s.data)}catch(s){console.error("Failed to load teams:",s)}finally{j(!1)}},f=t.is_team_event?t.enrolled_teams_count/t.max_participants*100:t.enrolled_count/t.max_participants*100,g=s=>{const v=s.target.value;_("team_id",v),w(h.find(m=>m.id===v))},S=()=>{if(o(!0),t.is_team_event&&!t.is_external&&!n.team_id){alert("Please select a team to enroll"),o(!1);return}C(route("events.enroll",t.event_id),{preserveScroll:!0,onSuccess:()=>{o(!1),x(s=>({...s,is_enrolled:!0,enrolled_count:s.is_team_event?s.enrolled_count+((c==null?void 0:c.members_count)||0):s.enrolled_count+1,enrolled_teams_count:s.is_team_event?(s.enrolled_teams_count||0)+1:s.enrolled_teams_count})),d&&d({...t,is_enrolled:!0,enrolled_count:t.is_team_event?t.enrolled_count+((c==null?void 0:c.members_count)||0):t.enrolled_count+1,enrolled_teams_count:t.is_team_event?(t.enrolled_teams_count||0)+1:t.enrolled_teams_count,enrolled_team:c}),i()},onError:()=>o(!1)})},L=()=>{o(!0),l(route("events.unenroll",t.event_id),{preserveScroll:!0,onSuccess:()=>{var v;o(!1);const s=((v=t.enrolled_team)==null?void 0:v.member_count)||1;x(m=>({...m,is_enrolled:!1,enrolled_count:m.is_team_event?m.enrolled_count-s:m.enrolled_count-1,enrolled_teams_count:m.is_team_event?(m.enrolled_teams_count||0)-1:m.enrolled_teams_count,enrolled_team:null})),d&&d({...t,is_enrolled:!1,enrolled_count:t.is_team_event?t.enrolled_count-s:t.enrolled_count-1,enrolled_teams_count:t.is_team_event?(t.enrolled_teams_count||0)-1:t.enrolled_teams_count,enrolled_team:null})},onError:()=>o(!1)})},U=()=>{window.open(t.registration_url,"_blank")};return e.jsx(I,{children:e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex min-h-screen items-center justify-center p-4",children:[e.jsx(N.div,{style:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:p,className:"fixed inset-0 bg-black/60 backdrop-blur-sm"}),e.jsxs(N.div,{style:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"relative w-full max-w-2xl rounded-2xl bg-white shadow-xl border border-orange-100",children:[e.jsx("button",{onClick:p,className:"absolute right-4 top-4 z-10 text-gray-500 hover:text-gray-900 transition-colors p-2 hover:bg-gray-100 rounded-full",children:e.jsx("span",{className:"material-symbols-outlined",children:"close"})}),e.jsxs("div",{className:"relative h-48 rounded-t-2xl overflow-hidden",children:[e.jsx("img",{src:t.cover_image?`/${t.cover_image}`:"/default-event-image.jpg",alt:t.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-white to-transparent"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t.title}),e.jsxs("div",{className:"flex items-center space-x-2",children:[t.is_external&&e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-purple-500/20 text-purple-400",children:"External Event"}),t.is_team_event&&e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-blue-500/20 text-blue-400",children:"Team Event"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${t.status==="Upcoming"?"bg-green-500/20 text-green-400":t.status==="Ongoing"?"bg-blue-500/20 text-blue-400":"bg-gray-500/20 text-gray-400"}`,children:t.status})]})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:t.is_external?`Organized by ${t.organizer_name}`:`Created by ${t.creator.name}`})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Date & Time"}),e.jsxs("div",{className:"flex items-center text-gray-900",children:[e.jsx("span",{className:"material-symbols-outlined mr-2 text-blue-400",children:"calendar_today"}),e.jsxs("span",{children:[M(new Date(t.date),"MMMM dd, yyyy")," at ",t.formatted_time]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Location"}),e.jsxs("div",{className:"flex items-center text-gray-900",children:[e.jsx("span",{className:"material-symbols-outlined mr-2 text-green-400",children:"location_on"}),e.jsx("span",{children:t.location})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Event Type"}),e.jsxs("div",{className:"flex items-center text-gray-900",children:[e.jsx("span",{className:"material-symbols-outlined mr-2 text-purple-400",children:"category"}),e.jsx("span",{children:t.event_type})]})]}),t.is_team_event&&!t.is_external&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Team Requirements"}),e.jsxs("div",{className:"flex items-center text-gray-900",children:[e.jsx("span",{className:"material-symbols-outlined mr-2 text-amber-400",children:"group"}),e.jsx("span",{children:t.min_team_members===t.max_team_members?`Exactly ${t.min_team_members} members per team`:`${t.min_team_members}-${t.max_team_members} members per team`})]})]}),!t.is_external&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:t.is_team_event?"Team Enrollment Status":"Enrollment Status"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-900",children:t.is_team_event?`${t.enrolled_teams_count||0} teams enrolled of ${t.max_participants} spots`:`${t.enrolled_count} enrolled of ${t.max_participants} spots`}),e.jsx("span",{className:"text-gray-900",children:t.is_team_event?`${((t.enrolled_teams_count||0)/t.max_participants*100).toFixed(0)}%`:`${(t.enrolled_count/t.max_participants*100).toFixed(0)}%`})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${f>=90?"bg-red-500":f>=75?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(f,100)}%`}})})]})]}),t.is_enrolled&&t.is_team_event&&t.enrolled_team&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Your Team"}),e.jsxs("div",{className:"flex items-center text-gray-900",children:[e.jsx("span",{className:"material-symbols-outlined mr-2 text-indigo-400",children:"people"}),e.jsxs("span",{children:[t.enrolled_team.name," (",t.enrolled_team.member_count," members)"]})]})]}),t.is_external&&t.organizer_website&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Organizer Website"}),e.jsxs("div",{className:"flex items-center text-gray-900",children:[e.jsx("span",{className:"material-symbols-outlined mr-2 text-blue-400",children:"language"}),e.jsx("a",{href:t.organizer_website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-500 transition-colors",children:"Visit Website"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Description"}),e.jsx("p",{className:"text-gray-900 whitespace-pre-line",children:t.description})]}),t.label_tags&&t.label_tags.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-400 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-sm text-indigo-400",children:"label"}),"Event Categories"]}),e.jsx(R,{tags:t.label_tags,maxDisplay:50,showCount:!1,className:"gap-2"})]}),t.is_team_event&&!t.is_external&&!t.is_enrolled&&t.status==="Upcoming"&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Select Your Team"}),k?e.jsx("div",{className:"text-gray-400",children:"Loading available teams..."}):h.length===0?e.jsxs("div",{children:[e.jsx("div",{className:"text-amber-400",children:"You don't have any eligible teams that meet the size requirements. Create a team or adjust your existing team before enrolling."}),e.jsx("div",{children:e.jsx("span",{className:"text-xs text-red-400 mt-1",children:"*Only Team Leaders can unenroll their teams."})})]}):e.jsxs("select",{value:n.team_id,onChange:g,className:"w-full bg-white border border-gray-300 rounded-lg px-4 py-2 text-gray-900 focus:ring-[#F37022] focus:border-[#F37022]",children:[e.jsx("option",{value:"",children:"Select a team"}),h.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.members_count," members)"]},s.id))]})]}),e.jsxs("div",{className:"mt-6 flex justify-between items-center",children:[e.jsx(P,{event:t}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:p,className:"px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors",children:"Close"}),t.is_external?e.jsx("button",{onClick:U,className:"px-4 py-2 bg-[#F37022] hover:bg-[#e3641a] text-white rounded-lg transition-colors",children:"Register at External Site"}):t.is_enrolled?t.is_team_event&&t.enrolled_team&&t.enrolled_team.creator_id!==((T=b==null?void 0:b.user)==null?void 0:T.id)?e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("button",{disabled:!0,className:"px-4 py-2 bg-gray-500 text-white rounded-lg transition-colors opacity-50 cursor-not-allowed",children:"Team Leader Action Required"}),e.jsxs("span",{className:"text-xs text-yellow-400 mt-1",children:["Only ",((A=t.enrolled_team.creator)==null?void 0:A.name)||"the team leader"," can unenroll the team"]})]}):e.jsx("button",{onClick:L,disabled:u||t.status!=="Upcoming",className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Processing...":t.is_team_event?"Unenroll Team":"Unenroll"}):e.jsx("button",{onClick:S,disabled:u||t.status!=="Upcoming"||(t.is_team_event?t.enrolled_teams_count>=t.max_participants||!n.team_id||h.length===0:t.enrolled_count>=t.max_participants),className:"px-4 py-2 bg-[#F37022] hover:bg-[#e3641a] text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Processing...":t.is_team_event?t.enrolled_teams_count>=t.max_participants?"Event Full":h.length===0?"No Eligible Teams":"Enroll Team":t.enrolled_count>=t.max_participants?"Event Full":"Enroll Now"})]})]})]})]})]})})})}export{q as E};
